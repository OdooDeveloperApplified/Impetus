<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Document Layout template -->
    <template id="document_production_voucher" >
        <t t-call="web.basic_layout">
            <!-- HEADER -->
            <div class="o_boxed_header" style="text-align:center; line-height:1.4;border: 1px solid black; box-sizing: border-box; margin: 0; color:black; border-bottom:none;"> 
                <strong><p style="text-align: center; font-size:20px; border-bottom:1px solid black; width:25%; margin: 0 auto;"><b>Production Voucher</b></p></strong>
                <h1 style="text-align: center; margin: 4px 0;">IMPETUS PROLIFIC PVT LTD</h1>
                <p style="text-align: center; padding-bottom:10px;">
                    <t t-esc="res_company.street"/><t t-esc="res_company.street2"/><br/>
                    <t t-esc="res_company.city"/> - <t t-esc="res_company.zip"/><br/>
                </p>
            </div>
            <!-- Inner content -->
            <div>
                <t t-out="0"/>
            </div>

            <!-- Footer -->
            <div class="footer" style="text-align:center; font-size:12px; border-top:1px solid #000; padding-top:5px;">
            </div>
        </t>
    </template>

    <!-- Report content section (Inner content) -->
    <template id="production_voucher_views">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="impel_manufacturing.document_production_voucher">
                    <style>
                        /* Force border to appear on every physical page in PDF */
                        @page {
                            margin: 5mm;
                            /* draw a 1px black border around every page */
                            border: 1px solid black;
                        }

                        /* Keep your existing .page styling untouched */
                        .page {
                            
                            box-sizing: border-box;
                            margin: 0;
                            padding: 0;
                        }

                        /* Ensure header/footer overlap with border */
                        body {
                            margin: 0;
                            padding: 0;
                        }
                    </style>
                    
                    <div class="page" style="border: 1px solid black; box-sizing: border-box; margin: 0; color:black;">
                        <!-- Information block -->
                        <div style="width:100%; padding-top:10px; padding-bottom:8px;">
                            <div style="display:inline-block; vertical-align:top; width:49%; box-sizing:border-box; padding-left:6px;">
                                <span><strong>MC Generated:</strong></span><br/>
                                <span><strong>MC Consumed: </strong></span><br/>
                            </div>
                            <div style="display:inline-block; vertical-align:top; width:49%; box-sizing:border-box; padding-left:6px;">
                                <!-- Right Column Content -->
                                <span>No.: <t t-esc="o.name"/></span><br/>
                                <span>Dated: <t t-esc="o.date_deadline"/></span><br/>
                            </div>
                        </div>

                        <style>
                            table.only-column-borders {
                                border-collapse: collapse;
                                width: 100%;
                            }

                            /* Regular column borders */
                            table.only-column-borders th,
                            table.only-column-borders td {
                                border-right: 1px solid black;
                            }

                            /* Top border for header row */
                            table.only-column-borders tr:first-child th {
                                border-top: 1px solid black;
                            }

                            /* Bottom border for last row */
                            table.only-column-borders tr:last-child td {
                                border-bottom: 1px solid black;
                            }

                            /* Remove right border from last column (both header body) */
                            table.only-column-borders th:last-child,
                            table.only-column-borders td:last-child {
                                border-right: none !important;
                            }

                            /* Remove any border-right from header row overrides */
                            table.only-column-borders thead tr th:last-child {
                                border-right: none !important;
                            }

                            /* Optional: remove any full-row border applied directly on in header */
                            table.only-column-borders thead tr {
                                border-right: none !important;
                            }
                        </style>
                        
                        <t t-set="counter" t-value="0"/>
                        <table class="table table-borderless" style="width:100%; border-collapse: collapse; color:black;">
                            <thead >
                                <tr style="text-align: center;border: 1px solid black; border-left:none;">
                                    <th class="text-start" style="width: 5%;vertical-align:center">S.N.</th>
                                    <th class="text-start" style="width: 40%;vertical-align:center">Description of Goods</th>
                                    <th class="text-start" style="width: 12%;vertical-align:center">HSN/SAC Code</th>
                                    <th class="text-start" style="width: 8%;vertical-align:center">Qty</th>
                                    <th class="text-start" style="width: 8%;vertical-align:center">Unit</th>
                                    <th class="text-end" style="width: 10%;vertical-align:center">Price</th>
                                    <th class="text-start" style="width: 9%;vertical-align:center">Amount</th>
                                </tr>
                            </thead>
                            
                            <tbody>
                                <t t-foreach="o.move_finished_ids" t-as="line">
                                    <t>
                                        <t t-set="counter" t-value="counter + 1"/>
                                        <t t-set="subtotal" t-value="line.product_uom_qty * line.product_id.standard_price"/>
                                        <tr>
                                            <td colspan="7" style="text-align:center; color:black;"><h5><u><b>Items Generated</b></u></h5></td>
                                        </tr>
                                        <tr style="border-bottom:1px solid black;">
                                            <td style="text-align:center;"><t t-esc="counter"/></td>
                                            <td><t t-esc="line.product_id.display_name or ''"/></td>
                                            <td><t t-esc="line.product_id.l10n_in_hsn_code or ''"/></td>
                                            <td style="text-align:center;"><t t-esc="line.product_uom_qty"/></td>
                                            <td style="text-align:center;"><t t-esc="line.product_uom.name or ''"/></td>
                                            <td style="text-align:right;"><t t-esc="line.product_id.standard_price"/></td>
                                            <td style="text-align:right;"><t t-esc="subtotal"/></td>
                                        </tr>
                                    </t>
                                </t>
                                <t t-foreach="o.move_finished_ids" t-as="line">
                                    <tr>
                                        <td colspan="3" style="text-align:right;"><h5><b>Grand Total</b></h5></td>
                                        <td style="text-align:center; text-decoration: underline;"><b><t t-esc="line.product_uom_qty"/></b></td>
                                        <td style="text-align:center"><t t-esc="line.product_uom.name or ''"/></td>
                                        <td></td>
                                        <td style="text-align:right; text-decoration: underline;"><b><t t-esc="subtotal"/></b></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <div t-if="o.move_raw_ids">
                            <t t-call="impel_manufacturing.mrp_production_components"/>
                        </div>                        
                    </div>

                    <div style="border:1px solid black; box-sizing:border-box; border-top:none;">
                        <div style="display:inline-block; vertical-align:top; box-sizing:border-box; padding-top:4px; padding-bottom:4px;">
                            <div style="margin-top:5px;">
                                <span style="padding-left:370px; font-size:17px;"><b>Grand Total</b></span>
                                <t t-set="total_qty" t-value="sum(line.product_uom_qty for line in o.move_raw_ids)"/>
                                <b><span style="padding-left:25px;" t-esc="total_qty"/></b>
                                <b><span style="padding-left:30px;">Units</span></b>
                                <t t-set="amount" t-value="sum(line.product_uom_qty * line.product_id.standard_price for line in o.move_raw_ids)"/>
                                <b><span style="padding-left:205px;" t-esc="amount"/></b>
                            </div>
                        </div>
                    </div>
                        
                    <!-- Terms & Signature Block -->
                    <div class="terms-signature text-end" style="width:100%; border:1px solid black; box-sizing:border-box; border-top:none; font-size:16px;">
                        <div style="display:inline-block; vertical-align:top; width:30%; box-sizing:border-box; padding-top:4px; padding-bottom:4px;">
                            <div style="margin-top:10px; text-align:right; padding-right:6px;">
                                <strong><b>For IMPETUS PROLIFIC PVT LTD</b></strong><br/><br/><br/>
                                <strong><b>Authorised Signatory</b></strong>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="mrp_production_components">
        <t t-set="counter" t-value="0"/>
        <table class="table table-sm o_main_table table-borderless" style="width:100%; border-collapse: collapse; color:black;">
            <thead style="display: table-row-group;">
                <tr>
                    <td colspan="7" style="text-align:center;"><h5><u><b>Items Consumed</b></u></h5></td>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="o.move_raw_ids" t-as="line">
                    <t>
                        <t t-set="counter" t-value="counter + 1"/>
                        <t t-set="unit_price" t-value="line.product_id.standard_price or 0.0"/>
                        <t t-set="subtotal" t-value="line.product_uom_qty * unit_price"/>
                        <tr style="border-top:black 1px solid;">
                            <td style="text-align:center;"><t t-esc="counter"/></td>
                            <td style="text-align:left;"> <t t-esc="line.product_id.display_name or ''"/></td>
                            <td style="text-align:right;"><t t-esc="line.product_id.l10n_in_hsn_code or ''"/></td>
                            <td style="text-align:right;"><t t-esc="line.product_uom_qty"/></td>
                            <td style="text-align:center;"><t t-esc="line.product_uom.name or ''"/></td>
                            <td style="text-align:right;"><t t-esc="line.product_id.standard_price"/></td>
                            <td style="text-align:right;"><t t-esc="subtotal"/></td>
                        </tr>
                    </t>
                </t>                
            </tbody>
        </table>
    </template>

    <!-- Code to set desried paper format for Sale order -->
    <record id="paperformat_production_custome" model="report.paperformat">
        <field name="name">Credit Note</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">15</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">5</field>
        <field name="margin_right">5</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">10</field>
        <field name="dpi">90</field>
    </record>

    <!-- Report Action -->
    <record id="production_voucher_report_action" model="ir.actions.report">
        <field name="name">Impel Production Voucher</field>
        <field name="model">mrp.production</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">impel_manufacturing.production_voucher_views</field>
        <field name="report_file">impel_manufacturing.production_voucher_views</field>
        <field name="attachment" eval="False"/>
        <field name="paperformat_id" ref="impel_manufacturing.paperformat_production_custome"/>
        <field name="binding_model_id" ref="mrp.model_mrp_production"/>
        <field name="binding_type">report</field>
    </record>
</odoo>